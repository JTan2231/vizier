# Copy this file to ~/.config/vizier/config.toml for user-wide settings or to .vizier/config.toml so the repo carries its defaults. When no --config-file is provided, Vizier loads the global config first (if it exists) and overlays .vizier/config.toml so repo entries override while missing keys inherit your personal defaults; VIZIER_CONFIG_FILE is only used when neither config file is present.
# Global defaults (apply unless overridden below)
# The CLI -p/--model override is wire-only; agent/Codex runs ignore model settings.
model = "gpt-4.1"
reasoning_effort = "medium"
backend = "agent"
# Commands fail fast when the selected backend is unavailable; there is no fallback toggle.
# Supported backends: `agent` (runs a shell script) or `wire`.
# Agent runs default to wrapped JSON handling: the exec command should stream JSON to stdout, Vizier tees it through an optional progress filter for stderr, and the final assistant text is extracted for stdout. Set output="passthrough" for legacy scripts that already split stdout/stderr. Bundled shims (`codex.sh`, `gemini.sh`) install under `share/vizier/agents/`; pick them via `label` or set `command` to your own script.

# Base agent runtime wiring shared by agent-backed commands unless a scoped override says otherwise
[agent]
label = "codex"                      # Use a bundled shim by label (codex.sh or gemini.sh)
# command = ["/usr/local/share/vizier/agents/codex.sh"] # Or point directly at a custom script
# output = "auto"                    # auto|wrapped-json|passthrough; auto wraps bundled shims, passthrough preserves legacy stdout
# progress_filter = ["jq", "-r", "..."] # Optional JSON-to-progress filter; defaults to the Codex jq filter when using the bundled codex shim
# Agent scopes inherit this runner; swap to another script by updating these fields (or a scoped `[agents.<scope>.agent]` table).

# Prompt profiles live under [agents.<scope>.prompts.<kind>]; each entry ties prompt text (inline or via `path`)
# together with backend/model overrides for that scope+prompt pairing. Available kinds: documentation, commit,
# implementation_plan, review, merge_conflict. See `docs/prompt-config-matrix.md` for the full scope√óprompt-kind
# matrix, fallback order, and documentation toggles.
[agents.default.prompts.documentation]
path = "./prompts/documentation.md"

[agents.draft.prompts.implementation_plan]
path = "./prompts/plan.md"
backend = "agent"

[agents.review.prompts.review]
path = "./prompts/review.md"
[agents.review.prompts.review.agent]
label = "codex"

# Order of operations the configured backend will run during `vizier review` unless `--skip-checks` is passed
[review.checks]
commands = [
  "cargo fmt -- --check",
  "cargo clippy -- -D warnings",
  "cargo test --all --all-targets"
]

# Default merge behavior (per-plan history will be [implementation commit, merge commit])
[merge]
# When true, Vizier squashes implementation commits before creating the merge commit.
squash = true
# Optional default mainline parent (1-based) when squashing plan branches that contain merge commits.
# squash_mainline = 2

# Default conflict-handling behavior for vizier merge (overridden by --auto-resolve-conflicts/--no-auto-resolve-conflicts)
[merge.conflicts]
auto_resolve = true

# Optional CI/CD gate script run during `vizier merge` (auto_resolve here controls gate remediation, not conflict handling)
[merge.cicd_gate]
script = "./cicd.sh"
auto_resolve = true
retries = 2

# Global workflow defaults (apply unless CLI overrides them)
[workflow]
# When true, assistant-backed commands hold their edits for manual commits until you rerun without --no-commit.
no_commit_default = false

# Default agent stack inherited by every command before CLI flags are processed (model/reasoning only apply on wire scopes)
[agents.default]
backend = "agent"

# Fine-tune how the default agent backend runs (label or explicit command)
[agents.default.agent]
label = "codex"
# command = ["./examples/agents/codex.sh"]
# output = "auto"                    # Leave unset to auto-wrap bundled shims; set to passthrough for scripts that already emit final text on stdout
# progress_filter = ["jq", "-r", "..."] # Optional; defaults to Codex jq filter when label=codex and no command is provided

# Force conversational asks onto the wire backend with a higher-effort reasoning profile
[agents.ask]
backend = "wire"
model = "gpt-4.1-preview"
reasoning_effort = "high"

# Keep save flows on the agent backend so narrative edits always use the same backend
[agents.save]
backend = "agent"

# The remaining plan workflow commands stay on the agent backend and inherit the defaults
[agents.draft]
backend = "agent"

[agents.approve]
backend = "agent"

[agents.review]
backend = "agent"

# Example: route review through Gemini instead of Codex via a script shim
# [agents.review]
# backend = "gemini"
# [agents.review.agent]
# command = ["./examples/agents/gemini.sh"]

# Allow merge-time agents to skip documentation prompt + narrative context when auto-resolving conflicts
[agents.merge.documentation]
enabled = false
include_snapshot = false
include_todo_threads = false

# Merge conflicts auto-resolve via the agent backend by default; swap to wire if you prefer manual conflict handling
[agents.merge]
backend = "agent"
