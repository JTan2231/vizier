# Copy this file to ~/.config/vizier/config.toml for user-wide settings or to .vizier/config.toml so the repo carries its defaults. When no --config-file is provided, Vizier loads the global config first (if it exists) and overlays .vizier/config.toml so repo entries override while missing keys inherit your personal defaults; VIZIER_CONFIG_FILE is only used when neither config file is present. See docs/config-reference.md for the full catalogue of keys, defaults, and CLI overrides.
# Global defaults (apply unless overridden below)
agent = "codex"
# Commands fail fast when the selected agent shim is unavailable; there is no fallback toggle.
# Supported selectors: bundled `codex`/`gemini` or any custom shim name present under share/vizier/agents/.
# Agent runs default to wrapped JSON handling: the exec command should stream JSON to stdout, Vizier tees it through an optional progress filter for stderr, and the final assistant text is extracted for stdout. Set output="passthrough" for legacy scripts that already split stdout/stderr. Bundled shims install under `share/vizier/agents/`; pick them via the selector above or override the runtime command per scope.

# Example: route every scope through your own script. Update the `[agents.default]` entry below (or
# whichever scopes you care about) so `agent = "custom"` and then uncomment this block to point
# Vizier at your script. Only one `agent` key can exist at the root of the file, so remove the scalar
# `agent = "codex"` above when this table is active.
# [agent]
# command = ["/usr/local/share/vizier/agents/codex/agent.sh"] # Or point directly at your script
# output = "auto"                    # auto|wrapped-json; auto wraps bundled shims
# progress_filter = ["./examples/agents/codex/filter.sh"] # Optional progress-to-stderr filter; defaults when selector=codex
# Agent scopes inherit this runner; swap to another script by updating these fields (or a scoped `[agents.<scope>.agent]` table).

# Prompt profiles live under [agents.<scope>.prompts.<kind>]; each entry ties prompt text (inline or via `path`)
# together with backend overrides for that scope+prompt pairing. Available kinds: documentation, commit,
# implementation_plan, review, merge_conflict. See `docs/prompt-config-matrix.md` for the full scope√óprompt-kind
# matrix, fallback order, and documentation toggles.
[agents.default.prompts.documentation]
path = "./prompts/documentation.md"

[agents.draft.prompts.implementation_plan]
path = "./prompts/plan.md"
agent = "codex"

[agents.review.prompts.review]
path = "./prompts/review.md"
agent = "codex"

# Order of operations the configured backend will run during `vizier review` unless `--skip-checks` is passed
[review.checks]
commands = [
  "cargo fmt -- --check",
  "cargo clippy -- -D warnings",
  "cargo test --all --all-targets"
]

# Default merge behavior (per-plan history will be [implementation commit, merge commit])
[merge]
# When true, Vizier squashes implementation commits before creating the merge commit.
squash = true
# Optional default mainline parent (1-based) when squashing plan branches that contain merge commits.
# squash_mainline = 2

# Default conflict-handling behavior for vizier merge (overridden by --auto-resolve-conflicts/--no-auto-resolve-conflicts)
[merge.conflicts]
auto_resolve = true

# Optional CI/CD gate script run during `vizier merge` (auto_resolve here controls gate remediation, not conflict handling)
[merge.cicd_gate]
script = "./cicd.sh"
auto_resolve = true
retries = 2

# Optional stop-condition for `vizier approve`: when configured, the agent is re-run on the draft branch until this script exits 0 or the retry budget is exhausted.
# [approve.stop_condition]
# script = "./scripts/approve-stop.sh"
# retries = 3

# Global workflow defaults (apply unless CLI overrides them)
[workflow]
# When true, assistant-backed commands hold their edits for manual commits until you rerun without --no-commit.
no_commit_default = false

[workflow.background]
# Allow/disallow background execution globally
enabled = true
# Silence progress chatter in background jobs unless explicitly overridden
quiet = true

# Default agent stack inherited by every command before CLI flags are processed
[agents.default]
agent = "codex"

# Example: route review through Gemini instead of Codex via a script shim
# [agents.review]
# agent = "gemini"
# [agents.review.agent]
# command = ["./examples/agents/gemini/agent.sh"]

# Keep save flows on the codex stack so narrative edits always use the same selector
[agents.save]
agent = "codex"

# The remaining plan workflow commands stay on the codex stack and inherit the defaults
[agents.draft]
agent = "codex"

[agents.approve]
agent = "codex"

[agents.review]
agent = "codex"

# Allow merge-time agents to skip documentation prompt + narrative context when auto-resolving conflicts
[agents.merge.documentation]
enabled = false
include_snapshot = false
include_narrative_docs = false

[agents.merge]
agent = "codex"
