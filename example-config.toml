# Copy this file to ~/.config/vizier/config.toml for user-wide settings or to .vizier/config.toml so the repo carries its defaults. When no --config-file is provided, Vizier loads the global config first (if it exists) and overlays .vizier/config.toml so repo entries override while missing keys inherit your personal defaults; VIZIER_CONFIG_FILE is only used when neither config file is present.
# Global defaults (apply unless overridden below)
# The CLI -p/--model override is wire-only; agent/Codex runs ignore model settings.
model = "gpt-4.1"
reasoning_effort = "medium"
backend = "agent"
# Commands fail fast when the selected backend is unavailable; there is no fallback toggle.
# Supported backends: `agent` (auto-resolves Codex or Gemini) or `wire`.
# When no agent command is configured, Vizier auto-discovers a supported agent CLI on PATH (preferring Codex, then Gemini) and builds the right startup command per backend.

# Base agent-backend wiring shared by agent-backed commands unless a scoped override says otherwise
[agent]
kind = "codex" # Pin the agent backend; omit to auto-detect a supported CLI from PATH
command = ["/usr/local/bin/agent-cli", "exec"]
profile = "default"
bounds_prompt_path = "/etc/vizier/agent_bounds.md"
extra_args = ["--log-json"]
# Agent scopes inherit this runner plus Codex's display adapter; swapping to another CLI agent means
# pointing these fields (or a scoped `[agents.<scope>.agent]` table) at the new command/profile.

# Prompt profiles live under [agents.<scope>.prompts.<kind>]; each entry ties prompt text (inline or via `path`)
# together with backend/model overrides for that scope+prompt pairing. Available kinds: documentation, commit,
# implementation_plan, review, merge_conflict.
[agents.default.prompts.documentation]
path = "./prompts/documentation.md"

[agents.draft.prompts.implementation_plan]
path = "./prompts/plan.md"
backend = "agent"

[agents.review.prompts.review]
path = "./prompts/review.md"
[agents.review.prompts.review.agent]
profile = "compliance"
bounds_prompt_path = "./prompts/review-bounds.md"

# Order of operations the configured backend will run during `vizier review` unless `--skip-checks` is passed
[review.checks]
commands = [
  "cargo fmt -- --check",
  "cargo clippy -- -D warnings",
  "cargo test --all --all-targets"
]

# Default merge behavior (per-plan history will be [implementation commit, merge commit])
[merge]
# When true, Vizier squashes implementation commits before creating the merge commit.
squash = true
# Optional default mainline parent (1-based) when squashing plan branches that contain merge commits.
# squash_mainline = 2

# Optional CI/CD gate script run during `vizier merge`
[merge.cicd_gate]
script = "./cicd.sh"
auto_resolve = true
retries = 2

# Global workflow defaults (apply unless CLI overrides them)
[workflow]
# When true, assistant-backed commands hold their edits for manual commits until you rerun without --no-commit.
no_commit_default = false

# Default agent stack inherited by every command before CLI flags are processed (model/reasoning only apply on wire scopes)
[agents.default]
backend = "agent"

# Fine-tune how the default agent backend runs (command/profile/bounds prompt/extra args)
[agents.default.agent]
kind = "codex"
command = ["/usr/local/bin/agent-cli", "exec"]
profile = "maintainers"
bounds_prompt_path = "/etc/vizier/agent_bounds.md"
extra_args = ["--log-json"]

# Force conversational asks onto the wire backend with a higher-effort reasoning profile
[agents.ask]
backend = "wire"
model = "gpt-4.1-preview"
reasoning_effort = "high"

# Keep save flows on the agent backend so narrative edits always use the same backend
[agents.save]
backend = "agent"

# Give save flows a stricter agent profile and extra arguments when editing the repo
[agents.save.agent]
profile = "auditor"
extra_args = ["--max-edits", "200"]

# The remaining plan workflow commands stay on the agent backend and inherit the defaults
[agents.draft]
backend = "agent"

[agents.approve]
backend = "agent"

[agents.review]
backend = "agent"

# Review runs the agent backend with a compliance profile and custom bounds prompt
[agents.review.agent]
profile = "compliance"
bounds_prompt_path = "./prompts/review-bounds.md"

# Example: route review through Gemini instead of Codex
# [agents.review]
# backend = "gemini"
# [agents.review.agent]
# command = ["gemini"] # optional; defaults to gemini when backend is set

# Allow merge-time agents to skip documentation prompt + narrative context when auto-resolving conflicts
[agents.merge.documentation]
enabled = false
include_snapshot = false
include_todo_threads = false

# Merge cleanup runs on wire to avoid editing worktrees directly
[agents.merge]
backend = "wire"
model = "gpt-4o-mini"
reasoning_effort = "low"
