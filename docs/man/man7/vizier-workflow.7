.TH VIZIER-WORKFLOW 7 "UNRELEASED" "Vizier" "Miscellaneous Information Manual"
.SH NAME
vizier-workflow \- operator workflow patterns for init, run, jobs, and release
.SH DESCRIPTION
Vizier exposes an operational surface focused on repository bootstrap,
plan visibility, workflow orchestration, scheduler introspection, and release
automation.
Internally, workflow-template metadata classifies agent execution as
\fBcap.agent.invoke\fR and prompt construction as explicit
\fBcap.env.*.prompt.resolve\fR nodes under a canonical-only \fBuses\fR contract
(\fBcap.env.*\fR, \fBcap.agent.invoke\fR, and \fBcontrol.*\fR only).
.SH COMMAND SET
.PP
Primary user-facing commands are:
.IP "\(bu" 2
\fBvizier init\fR / \fBvizier init --check\fR
.IP "\(bu" 2
\fBvizier list\fR
.IP "\(bu" 2
\fBvizier clean <job-id>\fR
.IP "\(bu" 2
\fBvizier jobs ...\fR
.IP "\(bu" 2
\fBvizier run <flow>\fR
.IP "\(bu" 2
\fBvizier audit <flow>\fR
.IP "\(bu" 2
\fBvizier release\fR
.IP "\(bu" 2
\fBvizier completions\fR
.PP
\fBvizier init\fR creates (or validates) the default repo scaffold:
\fI.vizier/narrative/{snapshot,glossary}.md\fR, \fI.vizier/config.toml\fR,
\fI.vizier/workflows/{draft,approve,merge,commit}.hcl\fR,
\fI.vizier/prompts/{DRAFT,APPROVE,MERGE,COMMIT}_PROMPTS.md\fR, root \fIci.sh\fR, and
required \fI.gitignore\fR runtime entries.
.PP
\fBvizier cd\fR remains exposed but returns a deprecation error in
scheduler-managed environments.
.PP
\fBvizier clean <job-id>\fR removes Vizier-managed runtime residue for one
job or an entire workflow run scope (when the requested job carries
\fBworkflow_run_id\fR metadata). Default safety guards refuse cleanup when
scoped jobs are active or referenced by non-scoped active jobs; these exits use
status code \fB10\fR. \fB--force\fR bypasses dependency/reference guards (but
never unsafe-path checks), and \fB--keep-branches\fR skips local draft-branch
deletion.
.PP
\fBvizier run <flow>\fR resolves in this order: explicit file path, configured
\fB[commands]\fR alias, then canonical selector identity (\fBtemplate.name@vN\fR).
There is no implicit repo/global flow-name fallback.
\fB[workflow.global_workflows]\fR only controls whether explicit file selectors
outside the repo are allowed under the configured global workflows directory.
For validation-only preflight, use \fBvizier run --check <flow>\fR; it performs
queue-time checks and exits without enqueueing jobs.
\fBvizier run\fR now infers default workflow locks at queue-time compile for
lockless nodes (executor/control except \fBcontrol.terminal\fR and
\fBcontrol.gate.approval\fR), deriving exclusive \fBbranch:<value>\fR locks from
branch context and falling back to \fBrepo_serial\fR when no branch scope exists.
Nodes that declare explicit \fBlocks\fR keep explicit-only behavior.
\fBvizier audit <flow>\fR runs the same queue-time preprocessing path and reports
produced artifacts, untethered \fBneeds\fR wiring, and per-node effective locks
with no enqueue/runtime side effects.
\fBvizier run\fR remains the only enqueue/execution front door.
.SH JOB OPERATIONS
Use \fBvizier jobs\fR to inspect and control background job records:
.IP "\(bu" 2
List/schedule views for queued/running/blocked jobs.
.IP "\(bu" 2
Tail/attach for stdout/stderr streams (including \fBjobs tail --follow\fR).
.IP "\(bu" 2
Approval/reject/retry/cancel/gc controls.
.SH RELEASE FLOW
Use \fBvizier release --dry-run\fR to preview release versioning and notes,
then \fBvizier release --yes\fR to create release artifacts.
.SH WORKFLOW GUIDE
For user docs, see:
.IP "\(bu" 2
\fIdocs/user/workflows/draft-approve-merge.md\fR
.IP "\(bu" 2
\fBvizier-workflow-template\fR(7) for authoring templates (capabilities, dependencies, and examples).
.SH SEE ALSO
.BR vizier (1),
.BR vizier-jobs (1),
.BR vizier-config (5),
.BR vizier-workflow-template (7)
