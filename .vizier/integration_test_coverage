[2025-09-28] Cross-link to Narrative timelines thread (snapshot Threads). Acceptance: integration tests should assert that new TODOs created during runs include a thread reference (ID) and that the snapshot Threads section lists them under the correct thread. Pointers: tests/src/main.rs (parsing .vizier/.snapshot and TODO bodies).

---

Update (author note: persistent config)
- Extend tests to cover profile persistence and precedence, including:
  • Running with --thinking-level without save does not mutate profiles.
  • --save-profile writes to .vizier/profile.toml (or profiles/<name>.toml) and is picked up on next run.
  • Precedence resolution when both a named profile and project default exist.
  • Non-interactive mode honors CLI override and does not prompt to save.
- Pointers: tests/src/main.rs; vizier-core/src/config.rs; vizier-cli/src/main.rs

---


---
Update (2025-10-02): Add cases for DAP-active flows: (1) Any directive updates .snapshot and/or TODOs unless "discuss-only" present. (2) Epilogue Outcome line present and reflects created/updated items. (3) Conversation commits only touch .vizier; staged A/M/D/R from user are preserved byte-for-byte.


---


---
Terminal-minimal + renderer-neutral coverage (2025-10-02)
- Add tests for:
  • TTY vs non-TTY gating: no ANSI/control sequences when stdout is not a TTY; status spinner only on TTY.
  • Outcome line presence/format after actions (including DAP-only .vizier updates); exact match with Auditor facts.
  • `--json-stream` emits versioned NDJSON events (message/tool/status/outcome); schema validated and stable.
  • Piping/redirect: output remains readable and line-oriented; no cursor hijacking.
- Pointers: tests/src/main.rs (harness to fake TTY), vizier-cli/src/actions.rs (epilogue), vizier-core/src/display.rs (event emission/render).


---


---
Agent Basic Command (Workflow B) coverage
- Cases:
  • `vizier agent run <todo>` creates agent/<id>-<slug> from base; main untouched. Assert Auditor facts and that staged A/M/D/R are preserved byte-for-byte.
  • Outcome line includes TODO id/title, branch, commit count, and PR URL if opened, else local review commands. Exact format validated.
  • No-remote and `--no-pr`: command succeeds; Outcome prints deterministic local review commands; exit code 0.
  • Non-interactive without <todo> fails with helpful message; with <todo> succeeds; TTY shows interactive picker.
  • `vizier save` after merge updates TODO body (Resolution appended; Done status optional) and Snapshot threads; session.json includes workflow metadata (branch, pr number/url, decision, timestamps).
  • Abort path cleans up branch/worktree idempotently; working tree identical to pre-run; session logs decision=abort.
  • JSON stream events present and valid (message/tool/status/outcome) during run and save.
- Pointers: vizier-cli/src/actions.rs; vizier-core/src/vcs.rs, auditor.rs, display.rs, chat.rs; tests/src/main.rs.


---

