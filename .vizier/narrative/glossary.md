# Glossary

- **A/M/D/R**: Auditor change buckets: Added / Modified / Deleted / Renamed.
- **`cap.agent.invoke`**: Canonical agent executor capability ID; runtime primitive that reads one prompt artifact and streams assistant output/telemetry without inline prompt construction.
- **Auditor**: Component that records run facts, summarizes repo edits, and writes session metadata.
- **Change discipline**: AGENTS.md contract that code changes must update docs/tests and pass `./cicd.sh`.
- **Clap unknown-subcommand path**: Standard parser failure surface used for removed commands; no custom migration text.
- **Code state**: Snapshot slice for user-visible behavior, interfaces, and constraints.
- **Commit-style summary**: User-facing one-line narrative maintenance response; detailed deltas stay internal.
- **Conventional-subject release-note filter**: `vizier release` includes notes only for Conventional Commit subject lines.
- **Current worktree evidence**: Snapshot code-state line that records the latest local `draft/*` branch inventory plus on-disk and tracked-deletion `.vizier/implementation-plans/*.md` evidence for the active worktree slug (including explicit no-deletion states).
- **Worktree evidence label**: Parenthetical in the current-worktree-evidence snapshot bullet (`draft/<slug>`, `revalidated <date>`) that identifies which live branch inventory the evidence was sampled from.
- **Default-Action Posture (DAP)**: Narrative upkeep default where turns update snapshot/glossary unless explicitly opted out.
- **Durable init markers**: `.vizier/narrative/snapshot.md` and `.vizier/narrative/glossary.md`.
- **Empty plan-doc inventory signal**: Evidence state where `.vizier/implementation-plans/` has no on-disk `.md` plan docs in a worktree (including when the directory itself is absent); used with branch inventory to quantify legacy drift.
- **Mixed plan-doc inventory signal**: Evidence state where `.vizier/implementation-plans/` has at least one on-disk plan doc while also carrying tracked deletions (`D .vizier/implementation-plans/<slug>.md`), signaling overlapping historical drift shapes in one worktree.
- **Executor class metadata**: Scheduler/job metadata fields `workflow_executor_class` + `workflow_executor_operation` (with optional `workflow_control_policy`) that define canonical workflow identity for scheduler/job records.
- **Execution-root metadata**: Job metadata field `execution_root` representing the logical filesystem root for workflow-node runtime (`.` = repo root).
- **Execution-root edge propagation**: Runtime behavior that copies execution context (`execution_root` + worktree ownership fields) along explicit workflow routes before downstream queue/retry handling.
- **Succeeded-edge atomic completion lock**: Workflow-node completion ordering where succeeded nodes perform source finalization, success-route context propagation, and one scheduler advancement inside a single `SchedulerLock` critical section so concurrent ticks cannot start successors before context persistence.
- **Execution-root reset contract**: Cleanup/retry rule where successful worktree cleanup resets `execution_root` to `.` and clears `worktree_*` ownership fields; degraded cleanup preserves context for recovery.
- **Git CLI invocation guard**: Codebase invariant that `rg -n 'Command::new\\(\"git\"\\)' vizier-core/src vizier-cli/src vizier-kernel/src tests/src` stays empty so runtime/test Git behavior cannot regress to shelling out.
- **Libgit2-only workflow Git runtime**: Runtime/test posture where worktree/merge/stage/patch/retry-cleanup Git flows execute through `vizier-core/src/vcs/*` helpers and `git2` APIs instead of `git` subprocesses.
- **Linked-worktree checkout fallback**: Branch-switch behavior that detaches HEAD before reattaching to a target branch when libgit2 rejects direct checkout because the branch is already the HEAD of a linked worktree.
- **Force-equivalent shared-branch worktree add**: `worktree.prepare` parity path that creates a temporary-branch worktree and repoints its HEAD to the requested branch so multiple linked worktrees can intentionally track the same branch.
- **Patch hunk-origin reconstruction**: Diff-print rule that re-adds `+`, `-`, and space origins to emitted patch lines so generated patches remain parseable by libgit2 patch-apply APIs.
- **Executor-first workflow model**: Internal template contract where each executor node declares exactly one executor class (`environment.builtin`, `environment.shell`, or `agent`) and control behavior is modeled separately.
- **Explicit `uses` declaration**: Validator rule that executor/control node identity must be declared via recognized `uses` IDs; unknown arbitrary labels are rejected (no implicit custom-command fallback).
- **`gen-man` drift gate**: `cargo run -p vizier --bin gen-man -- --check` validation that generated man pages are current.
- **Help pager contract**: Help text auto-pages only on TTY via `$VIZIER_PAGER` (or fallback pager), prints directly on non-TTY, and can be internally suppressed with hidden `--no-pager`.
- **Init check mode**: `vizier init --check`; validates the init contract without mutating files.
- **Jobs command surface**: Retained `vizier jobs` operations (`list`, `schedule`, `show`, `status`, `tail`, `attach`, `approve`, `reject`, `retry`, `cancel`, `gc`) over persisted job records.
- **Jobs ownership split**: Scheduler/job/workflow runtime side effects now live in `vizier-core/src/jobs/mod.rs`; `vizier-cli/src/jobs.rs` is a compatibility re-export shim used by existing CLI call sites.
- **Global workflow directory**: Default implicit alias source for `vizier run <flow>` at `<base_config_dir>/vizier/workflows` (or `[workflow.global_workflows].dir` override) when `[workflow.global_workflows].enabled = true`.
- **Stage alias map**: Repo-local `[commands]` config mapping (for example `draft`, `approve`, `merge`) that resolves `vizier run <alias>` to workflow file selectors.
- **Stage-template drift repair**: Repo-local recovery where `.vizier/config.toml` re-adds `[commands].draft|approve|merge` alias selectors and `.vizier/workflows/{draft,approve,merge}.toml` is restored from legacy `vizier.*` `uses` labels to canonical `cap.env.*`/`cap.agent.invoke`/`control.*` DAGs, including draft cleanup via explicit `after` from `stage_commit` and merge CI gate terminal settling for operator-driven retries.
- **Merge gate settle path**: Merge-stage template posture where `merge_gate_cicd` failures end as terminal `failed` jobs (no self-loop retry edge), so recovery uses explicit `vizier jobs retry <job_id>`.
- **Primitive stage templates**: Canonical stage DAG files (`.vizier/workflows/draft.toml`, `.vizier/workflows/approve.toml`, `.vizier/workflows/merge.toml`) executed through `vizier run` + scheduler jobs; no wrapper commands.
- **`vizier run` orchestrator**: Public workflow front-door that resolves a flow source, compiles/validates template nodes, enqueues scheduler jobs, and optionally follows to terminal state.
- **Legacy plan artifact drift**: Residual mismatch where `draft/*` branches and `.vizier/implementation-plans/*.md` files no longer align after workflow-command removal.
- **Live plan-doc deletion signal**: A tracked `D .vizier/implementation-plans/<slug>.md` state used as evidence that branch/doc inventories are diverging in a worktree.
- **Local `--follow` flag**: Follow mode is command-local on `vizier jobs tail --follow`; no global `--follow` remains.
- **Man-page taxonomy**: Installed sectioned docs under `man1` (`vizier`, `vizier-jobs`), `man5` (`vizier-config`), `man7` (`vizier-workflow`).
- **Canonical uses-only contract**: Workflow template identity policy that accepts only `cap.env.*`, `cap.agent.invoke`, and `control.*` `uses` IDs; legacy `vizier.*`, legacy non-env `cap.*`, and unknown labels fail validation immediately.
- **Canonical runtime operation inventory**: The full runtime dispatch set behind `__workflow-node`: 16 executor operations (`prompt.resolve`, `agent.invoke`, worktree/plan/git/patch/build/sentinel/shell ops) plus 5 control policies (`gate.stop_condition`, `gate.conflict_resolution`, `gate.cicd`, `gate.approval`, `terminal`) with no canonical placeholder fallthrough.
- **Legacy workflow capability field**: Historical job metadata key `workflow_capability_id`; retained for deserializing old records but no longer treated as active identity for new scheduler output.
- **Narrative state**: Snapshot slice covering active themes, tensions, and open/retired threads.
- **No-update signal**: Explicit turn-level instruction (`no-op:`, `discuss-only:`, or equivalent) that suppresses narrative edits.
- **Reduced CLI surface**: Supported top-level commands: `help`, `init`, `list`, `cd`, `clean`, `jobs`, `run`, `completions`, `release`.
- **Removed command family**: Hard-removed top-level commands: `save`, `draft`, `approve`, `review`, `merge`, `test-display`, `plan`, `build`, `patch`.
- **Pager flag contract drift**: Documentation mismatch where AGENTS advertises explicit `--pager` while the CLI currently rejects it and only retains hidden `--no-pager`.
- **Removed global flags**: Hard-removed globals: `--agent`, `--push`, `--no-commit`, `--follow`, `--pager`, `--background-job-id`.
- **Repo boundary**: Agent work stays inside the repository unless explicit authorization says otherwise.
- **Retired workflow threads**: Narrative docs preserved for historical context after hard-removal of workflow/agent command families.
- **Prompt artifact contract**: Canonical prompt payload wiring for executor templates: one custom artifact shaped `custom:prompt_text:<key>` produced by prompt-resolve nodes and consumed by canonical invoke nodes.
- **Prompt payload data store**: Optional typed JSON payload files for custom artifacts under `.vizier/jobs/artifacts/data/<type_hex>/<key_hex>/<job_id>.json`; scheduler gating still keys off marker files.
- **Prompt-resolve node**: Environment executor node (`cap.env.builtin.prompt.resolve` or `cap.env.shell.prompt.resolve`) that outputs exactly one prompt artifact for downstream `cap.agent.invoke`.
- **Runtime execution root resolution**: Workflow-node rule that resolves handler roots by precedence (`metadata.execution_root` -> repo root) with repo-boundary validation; legacy-only `metadata.worktree_path` metadata is rejected with migration guidance.
- **Sink policy (`terminal`)**: Canonical control-node contract where terminal nodes must have no outgoing routes; configured outgoing edges are treated as runtime failure.
- **Release dry run**: `vizier release --dry-run` preview mode for version bump and notes without commit/tag creation.
- **Session log**: Per-run artifact at `.vizier/sessions/<id>/session.json` when session logging is enabled.
- **Snapshot**: Canonical project frame in `.vizier/narrative/snapshot.md`.
- **snapshotDelta**: Internal narrative-diff artifact not printed in user-facing responses.
- **Steady-state inventory refresh**: Worktree inventory refresh where branch/doc/deletion evidence is unchanged from the previous reading; records freshness without introducing a new drift shape.
- **Thread doc**: Focused narrative file under `.vizier/narrative/threads/` for one tension.
- **Worktree**: Separate checkout under `.vizier/tmp-worktrees/`.
- **Worktree inventory refresh**: Periodic evidence check that captures local `draft/*` branches, on-disk `.vizier/implementation-plans/*.md` files, and tracked plan-doc deletions for the current worktree slug so legacy drift reporting stays current.
- **Workspace commands (`cd`/`clean`)**: Deprecated-but-retained worktree helpers currently still available on the reduced CLI surface.
- **`__workflow-node` entrypoint**: Hidden scheduler-only CLI command (`vizier __workflow-node --job-id <id>`) that executes one compiled workflow node and finalizes its job record.
- **Workflow node runtime metadata**: Job metadata fields `workflow_run_id`, `workflow_node_attempt`, `workflow_node_outcome`, and `workflow_payload_refs` used by runtime node execution and retry rewinds; workflow jobs may also carry `execution_root` + worktree ownership context.
- **Workflow run manifest**: Queue-time runtime file `.vizier/jobs/runs/<run_id>.json` containing per-node executor/control identity, args, retry policy, routing targets, and outcome artifact maps.
- **Workflow runtime bridge**: Internal execution layer that compiles canonical templates to scheduler jobs, dispatches node handlers through `__workflow-node`, and routes outcomes without exposing removed public workflow commands.
- **Run flow resolution order**: `FLOW` lookup contract: explicit `file:`/path, then `[commands]` alias, then canonical selector lookup (`template.name@vN`); unresolved flow names fail (no implicit repo/global fallback discovery).
- **Run `--set` Phase 1 surface**: Queue-time interpolation coverage for `vizier run --set` across `nodes.args`, artifact payloads (`needs`/`produces`), lock keys, custom precondition args, gate script/custom fields, gate bools, retry mode/budget, and artifact-contract IDs/versions.
- **Run `--set` strict coercion**: Queue-time typed coercion for expanded placeholders: bool tokens (`true|false|1|0|yes|no|on|off`), retry budget as decimal `u32`, and retry mode via canonical enum parsing; failures are field-path errors that prevent enqueue.
- **Run `--set` topology deferral**: Explicitly deferred interpolation scope for topology/identity fields (`after`, `on`, template `id/version`, imports, links) pending deterministic-graph policy decisions.
- **Run root overrides**: `vizier run` queue-time root-job schedule overrides: external `--after` dependencies and approval policy toggles (`--require-approval` / `--no-require-approval`).
- **Run grouped `--after` reference**: `vizier run --after run:<run_id>` queue-time expansion that reads `.vizier/jobs/runs/<run_id>.json`, selects success-terminal sink nodes (`routes.succeeded` empty), and converts the reference to concrete `schedule.after[*].job_id` dependencies.
- **Run bare-id `--after` rejection**: CLI guard that rejects bare `run_<id>` tokens for `--after` and instructs operators to use `run:<run_id>` when targeting workflow runs.
- **Run follow exit contract**: `vizier run --follow` aggregate terminal mapping: `0` all succeeded, `10` blocked-only terminal set, non-zero when any failed/cancelled job is terminal.
